
CREATE DEFINER=`root`@`localhost` PROCEDURE `actualizarProductoAlInventario`(
	id int,
    nombre varchar(100),
    precio int,
    detalle varchar(500),
    pcantidad int
)
BEGIN
	UPDATE producto
	SET nombreProducto = nombre,
	precio = precio
	WHERE idProducto = id;
    
	UPDATE inventario
    set Cantidad = pcantidad
    where idProducto = id;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `consultarArticulo`(id int)
BEGIN
select I.idProducto, P.nombreProducto nombre, P.precio precio, I.Cantidad cantidad 
from inventario I inner join producto P 
on I.idProducto = P.idProducto 
where I.idProducto = id;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `eliminarDeInventario`(id int)
BEGIN
	delete from inventario where idProducto = id;
    delete from producto where idProducto = id;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `insertarProductoAlInventario`(
    nombre varchar(100),
    precio int,
    detalle varchar(500),
    pcantidad int
)
BEGIN
	DECLARE id INT;
    insert into producto(nombreProducto, precio, detalle) 
    values (nombre, precio, detalle);
	set id = @@identity;
    insert into inventario(idProducto, cantidad) values (id, pcantidad);
    select id idp;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spConsultaNombreUsuario`(IN pUsername VARCHAR(25))
BEGIN
 	
	SELECT username
   
     FROM usuario
     
	WHERE username = pUsername; 
 
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spConsultaNombreUsuario`(IN pUsername VARCHAR(25))
BEGIN
 	
	SELECT username
   
     FROM usuario
     
	WHERE username = pUsername; 
 
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spInsertarUsuario`(IN pUsername VARCHAR(25),

 IN pPassword VARCHAR(12))
BEGIN
 	
	INSERT INTO usuario (username, password)
     
	VALUES (pUsername, pPassword);
	select @@Identity username;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spEliminarUsuario`(user varchar(25))
BEGIN
	delete from usuario where username = user;
    select 1;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spVerificaAdmin`(
 IN pUsername VARCHAR(25),
 
IN pPassword VARCHAR(12))
BEGIN
 	
	SELECT usernameAdmin
     
	FROM administrador
     
	WHERE usernameAdmin = pUsername AND password = pPassword;
 
 
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spVerificarCantidadInventario`(IN pIdProducto INT)
BEGIN
	SELECT cantidad
    	FROM inventario
    	WHERE idProducto = pIdProducto;

END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spVerificaUsuario`(IN pUsername VARCHAR(25),

 IN pPassword VARCHAR(12))
BEGIN
 	
	SELECT username
     
	FROM usuario
     
	WHERE username = pUsername AND password = pPassword;
 
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spRealizarCompra`(IN pIdUsuario INT,
IN pIdProducto INT,
IN pCantidad INT)
BEGIN
	INSERT INTO orden(idUsuario, idProducto, cantidad)
    VALUES (pIdUsuario, pIdProducto, pCantidad);
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `insertarOrden`(pUsername varchar(45))
BEGIN
	insert into orden (username)
    values(pUsername);
    select @@identity valor;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `insertarEnOrden`(pIdOrden int, pIdProducto int, pCantidad int)
BEGIN
	insert into productoxorden(idOrden, idProducto, cantidad) 
    values(pIdOrden, pIdProducto, pCantidad);
    
    -- decrementa el articulo de la tienda
    update inventario
	set Cantidad = Cantidad - pCantidad
	where idProducto = pIdProducto;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `consultarOrdenes`(user varchar(25))
BEGIN
	select P.idProducto Producto, P.cantidad Cantidad from orden O inner join productoxorden P 
	on O.idOrden = P.idOrden
    where O.username = user;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `obtenerValidosInventario`()
BEGIN
    select I.idProducto, I.Cantidad, P.nombreProducto, P.precio, P.detalle 
    from inventario I inner join producto P 
    where I.idProducto = P.idProducto and I.Cantidad > 0;
END

CREATE DEFINER=`root`@`localhost` PROCEDURE `spConsultaProductosUsuario`(IN pUsername VARCHAR(25))

BEGIN
	
	
	SELECT MIN(p.idProducto) id, p.nombreProducto nombre, p.precio
    
	FROM producto p
    
	
	INNER JOIN productoxorden po
		
		
	ON p.idProducto = po.idProducto
    
	
	INNER JOIN orden o
		
		
	ON po.idOrden = o.idOrden
	
	
	WHERE o.username = pUsername
    
	
	GROUP BY p.idProducto;


END